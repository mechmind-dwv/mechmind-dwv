<<<<<<< HEAD
<<<<<<< HEAD
name: Build Robotics Docs
on: push
=======
name: "ğŸ“œ MechMind Documentation Engine"

# ======================
# ğŸ” PERMISOS DE SEGURIDAD
# ======================
=======

name: "ğŸ“œ MechMind Documentation Engine"

# ======================
# ğŸ” PERMISOS DE SEGURIDAD
# ======================

name: Build Robotics Docs
on: push
>>>>>>> origin/main
permissions:
  contents: read      # Acceso mÃ­nimo al cÃ³digo
  pages: write        # Despliegue en GitHub Pages
  id-token: write     # AutenticaciÃ³n OIDC segura
  deployments: write  # Para seguimiento de despliegues
<<<<<<< HEAD
>>>>>>> 18737787 (Agrega nuevos archivos y modificaciones listados)
=======

name: "ğŸ“œ MechMind Documentation Engine"
>>>>>>> origin/main

# ======================
# ğŸ•’ DISPARADORES
# ======================
on:
  push:
    branches: [ "main" ]
    paths:
      - 'docs/**'
      - 'projects/mechbot-2x/src/**'
  workflow_dispatch:
    inputs:
      force-rebuild:
        description: 'Reconstruir completamente'
        required: false
        type: boolean

# ======================
# ğŸ—ï¸ CONFIGURACIÃ“N GLOBAL
# ======================
env:
  RUST_VERSION: "nightly-2024-03-01"
  DOCS_DIR: "docs/robotics/api"

# ======================
# ğŸ› ï¸ JOBS PRINCIPALES
# ======================
jobs:
  documentation:
    name: "ğŸ“š Generar DocumentaciÃ³n"
    runs-on: ubuntu-latest
<<<<<<< HEAD
<<<<<<< HEAD
    steps:
=======



>>>>>>> origin/main
      - uses: actions/checkout@v4

      - name: Generate RustDoc
        run: |
          cd docs/robotics/firmware
          cargo doc --no-deps
          mv target/doc ./api/rustdoc
<<<<<<< HEAD
=======
    container:
      image: rustlang/rust:${{ env.RUST_VERSION }}
      options: --privileged  # Requerido para algunos crates
>>>>>>> 18737787 (Agrega nuevos archivos y modificaciones listados)

=======
       steps:
       container:
      image: rustlang/rust:${{ env.RUST_VERSION }}
      options: --privileged  # Requerido para algunos crates


      # Requerido para algunos crates

>>>>>>> origin/main
    # ======================
    # ğŸŒ ENTORNO DE EJECUCIÃ“N
    # ======================
    environment:
      name: mechmind-docs
      url: ${{ steps.deployment.outputs.page_url }}

    steps:
      # ======================
      # 1. PREPARACIÃ“N
      # ======================
      - name: "ğŸ›¸ Checkout del CÃ³digo"
        uses: actions/checkout@v4
        with:
<<<<<<< HEAD
<<<<<<< HEAD
          name: mechbot-docs
          path: docs/robotics/api/
=======
          fetch-depth: 0
          submodules: recursive
          persist-credentials: false

=======

         fetch-depth: 0
          submodules: recursive
          persist-credentials: false



>>>>>>> origin/main
      # ======================
      # 2. CONFIGURACIÃ“N RUST
      # ======================
      - name: "âš™ï¸ Configurar Toolchain"
        run: |
          rustup component add rust-docs
          rustup target add wasm32-unknown-unknown
          echo "CARGO_TARGET_DIR=./target-docs" >> $GITHUB_ENV

      # ======================
      # 3. GENERACIÃ“N DE DOCS
      # ======================
      - name: "ğŸ¦€ Generar RustDoc Avanzado"
        working-directory: ${{ env.DOCS_DIR }}
        run: |
          cargo doc \
            --no-deps \
            --document-private-items \
            --all-features \
            --target-dir ${{ env.CARGO_TARGET_DIR }} \
            --offline
<<<<<<< HEAD
>>>>>>> 18737787 (Agrega nuevos archivos y modificaciones listados)
          
=======

       - name: mechbot-docs
>>>>>>> origin/main
          # Post-procesamiento de docs
          find target-docs/doc -name "*.html" -exec \
            sed -i 's/<body>/<body class="mechmind-theme">/g' {} \;

      # ======================
      # 4. CONTROL DE CALIDAD
      # ======================
      - name: "ğŸ” Validar DocumentaciÃ³n"
        run: |
          # Verificar links rotos
          pip install linkchecker
          linkchecker ${{ env.DOCS_DIR }}/target-docs/doc

      # ======================
      # 5. DESPLIEGUE
      # ======================
      - name: "ğŸš€ Desplegar en GitHub Pages"
        uses: actions/deploy-pages@v4
        id: deployment
        with:
          token: ${{ secrets.MECHMIND_DEPLOY_KEY }}
          target-branch: gh-pages
          publish-dir: ${{ env.DOCS_DIR }}/target-docs/doc
          environment-name: mechmind-docs

      # ======================
      # 6. NOTIFICACIONES
      # ======================
      - name: "ğŸ“¨ Notificar Equipo"
        if: always()
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ğŸ“š DocumentaciÃ³n actualizada: ${process.env.DOCS_VERSION}\nğŸŒ Vista previa: ${{ steps.deployment.outputs.page_url }}`
            })
